# Two-Phase Prompt Template

## Purpose

Force models to generate artifacts BEFORE implementation.

---

## Phase 1: Artifact Generation Only

```
You are a software architect. Your task is to design a feature BEFORE implementation.

## Task
{task_spec}

## Output Requirements

You MUST output the following artifacts in this exact format:

### 1. Gherkin Test Scenarios

```gherkin
Feature: [Feature Name]
  As a [user type]
  I want [goal]
  So that [benefit]

  Scenario: [Scenario 1]
    Given [context]
    When [action]
    Then [expected result]

  Scenario: [Scenario 2]
    ...
```

### 2. OpenAPI Specification

```yaml
openapi: 3.0.0
info:
  title: [API Title]
  version: 1.0.0
paths:
  /api/endpoint:
    get:
      summary: [description]
      responses:
        '200':
          ...
```

### 3. SQL Migration

```sql
-- Migration: add_[feature]_to_[table]
ALTER TABLE [table] ADD COLUMN [column] [type];

-- Rollback
ALTER TABLE [table] DROP COLUMN [column];
```

## Rules
- DO NOT write implementation code yet
- DO write complete, valid artifacts
- Each artifact MUST be parseable (valid Gherkin, valid YAML, valid SQL)
- STOP after generating all three artifacts
```

---

## Phase 2: Implementation

```
You are a software engineer. Implement the feature using the artifacts below.

## Task
{task_spec}

## Artifacts (generated by architect)

### Gherkin
{phase1_gherkin_output}

### OpenAPI
{phase1_openapi_output}

### SQL
{phase1_sql_output}

## Implementation Requirements

1. Follow the stack decomposition strategy:
   - Step 1: Apply database migration
   - Step 2: Update model
   - Step 3: Update API
   - Step 4: Update tests

2. For each step, output:
   - File path
   - Complete code changes (diff or full file)

3. Ensure code:
   - Follows existing patterns in the codebase
   - Is syntactically correct
   - Handles edge cases
```

---

## Usage

```bash
# Phase 1: Generate artifacts
./run-two-phase.sh --task outline_crud_001 --phase 1 --model haiku

# Phase 2: Implement (uses Phase 1 output)
./run-two-phase.sh --task outline_crud_001 --phase 2 --model haiku
```
